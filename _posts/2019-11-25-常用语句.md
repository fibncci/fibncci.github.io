---
layout: post
title: "研究生ＳＡＳ应用讲义"
date: 2019-11-23
tag: sas
---



## 研究生ＳＡＳ应用讲义

Statistical Analysis System 简称为SAS,可用来分析数 据和编写报告.它是美国SAS研究所的产品,在国际 上被誉为标准软件,在我国深受医学、农林、财经、社
会科学、行政管理等众多领域的专业工作者的好评。 有关ＳＡＳ的最新信息，可以查看 http://www.sas.com.cn。
ＳＡＳ采用积木式模块结构，
其中的ＳＡＳ/ＳＴＡＴ模块是目前功能最强的多元统 计分析程序集,可以做回归分析、聚类分析、判别分析、 主成分分析、因子分析、典型相关分析(下学期介绍) 以及各种试验设计的方差分析和协方差分析。 本讲义围绕SAS的应用,讲述以下六部分内容：
（１）ＳＡＳ应用基础； （２）ＳＡＳ常用语句；
（３）ＳＡＳ服务过程； （４）描述性统计程式；

（201５1/10/）14

方差分析程式；	（６）回归分析程式；	2

第一讲 ＳＡＳ应用基础

1.1	ＳＡＳ的显示管理系统 启动计算机,点击SAS图标后,即可进入SAS的显示管理 系统.在View中有四个主要的窗口(其他的先不考虑)：
(1)编辑窗口(program editor):编辑程式和数据文件;
(2)日志窗口(log):记录运行情况, 显示error信息;
(3)输出窗口(output):输出运行的结果;
(4)图形窗口(graph):输出图形.
点击 View 菜单中的 Program editor、Log、Output、
Graph 命令可以进入编辑、日志、输出及图形窗口.
按功能键F5、F6、F7也可以进入编辑、日志及输出窗口.
退出SAS有两种方法：
(1) 点击 File 菜单中的 Exit 命令；
2011(/120/1)4 点击窗口右上角的×。	3

１.2	SAS的功能键



用功能键可以代替对菜单的点击,，有时比较方便, 最常用的功能键有
F1 :显示帮助信息(help);
Ｆ4 :显示已经运行的程式(recall);
Ｆ5 :进入编辑窗口（pgm）；
Ｆ6 :进入日志窗口（ＬＯＧ）;
Ｆ7 :进入输出窗口（ＯＵＴＰＵＴ）;
Ｆ8 :程式提交运行（ＳＵＢＭＩＴ）;
Ｆ9 :显示功能键（ＫＥＹＳ）;
以上功能键的用法熟悉之后,还可以定义或修改功能键.
例如，可以定义Ctrl+E为功能键,用来清屏.

１.３ SAS的程式结构
在ＳＡＳ中,对数据的处理可划分为两大步骤：
(1)将数据读入SAS建立的SAS数据集,称为数据步(data)；
(2)调用ＳＡＳ的模块处理和分析数据集中的数据,
称为过程步(proc).
每一数据步都是以data语句开始,以run语句结束.
而每一过程步则都是以proc语句开始,以run语句结束.
当有多个数据步或过程步时,由于后一个data或proc语
句可以起到前一步的run语句的作用,两步中间的run语
句也就可以省略.
但是最后一步的后面必须有run语句,否则不能运行.

SAS还规定,每个语句的后面都要用符号“;”作为这个语 句结束的标志.
在编辑SAS程式时,一个语句可以写成多行,多个语句
也可以写成一行,可以从一行的开头写起,也可以从一行
的任一位置写起.每一行输入完成后,用enter键可以使光
标移到下一行的开头处.


1.4	SAS程式的输入及运行
ＳＡＳ程式的输入及运行步骤如下：
（１）进入SAS的显示管理系统；
（２）进入并扩大编辑窗口；
（３）调出、编辑或修改SAS程式或数据文件；
（４）将编辑窗口的SAS程式或数据文件存盘；

(5)按功能键F8或点击“跑步”键运行SAS程
式并注意观察日志窗口中的信息，如有error
出现，应将光标移到日志窗口，用pgup和
pgdn两键翻页，找到错误的所在；
(6)将光标移到编辑窗口，按功能键F4或点击
Locals菜单中的 Recall text命令调出已经运行的
ＳＡＳ程式，改正错误后转入步骤（４）， 直到日志窗口中的信息没有error出现为止；
(7)将光标移到输出窗口，用pgup和pgdn两键翻 页阅读输出的结果。
〖上机练习1.1〗进入SAS的显示管理系统， 在编辑窗口输入程式：
data ex;	a=1;b=2;c=3;
x=2*a+b; y=a-b/2;	z=b+c**3;


2011/10/14

proc; print; run; 	7

在程式中,data后面的ex是给数据集所取的名字(还可以 用其他名字).
在这个数据集内将储存变量ａ、ｂ、ｃ、ｘ、ｙ、ｚ 及它们所取的值,proc后面的print是要打印６个变量 所取的值.
!将程式提交运行后，注意日志窗口中的信息。



NOTE: The data set WORK.EX has 1 observations and 6 variables.
NOTE: The DATA statement used 0.71 seconds.
3	proc；
error 10-205: Expecting the name of the procedure to be executed.

3	print；
error 180-322: Statement is not valid or it is used out of proper order.
3	run；
error 180-322:Statement is not valid or it is used out of proper order.


在日志中记录了一个错误，那就是在proc与print 之间不应该有“;”这个符号。将它去掉以后，请再注意 日志窗口中的信息并阅读输出窗口中输出的结果.

〖上机练习1.２〗进入ＳＡＳ的显示管理系统， 在编辑窗口输入程式：

```
data ex; input no$	sex$	age	h	w; cards;
10	f	47 156.3 47.1
24	m 38 172.4 61.5
53	m	41 169.2 64.5
46	f	52 158.2 53.6
38	f 39 160.1 48
;
proc sort;by sex;
proc means;by sex;var h w; run;
```



在程式中，input定义与数据相对应的变量名、



顺序及类型，其中no$与sex $是非数字型的串变量， cards数据行开始的标志，数据行下面的“；” 独占一行是数据行结束的标志，sort是将ＳＡＳ 数据集中的观测值按一个或多个变量进行排序， 后面的by sex是要根据sex的值对上述观测值进行 分组处理，而means则是要在分组处理后按var的要 求给出变量h和w的简单的描述性统计分析结果， 如下图所示。

----------------------SEA=f----------------------
N Obs Variable N Minimum Maximum Mean Std Dev
3	H	3	156.3	160.1	158.2	1.90
2011/10/14	W	3	47.1	53.6	49.6	3.5211

----------------------SEA=m------------------N

Obs	Variable	N	Minimum	Maximum	Mean	Std Dev
2	H	2	169.2	172.4	170.8	2.26

​	W	2	61.5	64.5	63.0	2.12


在程式中，cards；与“;”之间是数据, 第一列是变量no$的数据，表示学生的号码； 第二列是变量sex$的数据，表示性别； 第三列是变量age的数据，表示年龄； 第四列是变量h的数据，表示身高； 第五列是变量w的数据，表示体重。






而输出的结果为:
女生组有3人,身高在156.3至160.1之间, 均值为158.2,标准差为1.90;体重在47.1至53.6之间, 均值为49.6，标准差为3.52； 男生组有2人,身高在169.2至172.4之间,均值为170.8, 标准差为2.26;体重在61.5至64.5之间，均值为63, 标准差为2.12。

第二讲 SAS常用语句



在SAS中,数据集的建立、变换以及对数据集的统计 分析都是通过SAS语句来实现的.常用的SAS语句有:



２.１ DATA语句
DATA语句的作用是表明数据步的开始并给出数据集
的名称。
DATA语句的格式为：
DATA 数据集的名称；
数据集的名称必须以英文字母开始，
最长不超过８个字符.


数据集的名称都是由符号“．”分隔的两个部分所组成。
第一部分标记数据集所存储的位置,称作一级名或库
逻辑名.
第二部分标记一个特定的数据集,称作二级名.
如果不想把数据集永久储存在指定的磁盘上,可以只
使用二级名.例如建立一个名为ex的数据集的语句为
“DATA	ex;”，这时SAS系统会自动地把ex作为数
据集的二级名,并添加work作为数据集的一级名,
因此在日志窗口显示的信息中记该数据集为work.ex.
但是这个数据集是临时的,它仅仅在程式运行期间有效,
过后它就被复盖,不能重新调用。

２.２	CARDS语句



CARDS语句的作用是与“;”呼应,标志数据行的开 始与结束。
ＣＡＲＤＳ语句的格式为：
ＣＡＲＤＳ；
数据行
；
如果使用CARDS语句，在CARDS的后面必
须紧跟数据行，并且在一个数据步中最多只能有 一个CARDS语句.

２.３	INPUT语句




INPUT语句的作用是描述输入记录中的数据,并把输 入值赋给相应的变量.
INPUT语句的格式为：
INPUT	数据的变量名、顺序及类型；
用INPUT语句是为了读外部文件的数据或跟
在CARDS语句后面的数据. 除非在INPUT语句中的变量名后有串符号或用字符
的输入格式表示、或该变量事先已被定义为字符型， 否则ＳＡＳ认定用INPUT语句读入的是数值型 变量的值.


用INPUT语句时,外部文件中的数据和CARDS语句后面的 数据都采取列表输入的方法，各个变量的值由它们之
间的空格来分隔。为从一行读入多个观测值，应使用
行保持符＠＠限制读数指针，使其保持在这一行上读 数，直到数据读完为止.




例如：input x y@@; cards;
3.16 2.9 5.8 3 4.9 4.17
;

２.４ infile语句



INFILE 语句的作用是指明外部数据文件的名称, 并从这个外部数据文件中读取数据。
INFILE语句的格式为：
INFILE ‘外部数据文件名’；
例如，在D盘上有一个名称为xiao.txt的数据文件，
其中数据排列为:
A 3.16 B 2.9 B 5.8 B 3 A 4.9 A 4.17
用INFILE 语句读取数据的程式为：
data ex;
infile 'D:xiao.txt'; input z$ x@@; proc print;run;

用infile语句读取数据时,要求外部数据文件 必须是可以在操作系统中用type命令打印出全部 内容的ASCII码文本文件。







２.５ SET语句
SET语句的作用是按照指定的条件从指定的数据
集中读取数据建立新的数据集或将两个数据集中的观 测值纵向连接建立新的数据集。

SET语句的格式为：
SET 数据集名表；
例如,从数据集EX中读取数据建立新的
数据集ＥＸ１，可编辑语句：
DATA	EX1；
SET EX；
将两个数据集Ｄ1和Ｄ2中的观测值纵向连接建
立新的数据集Ｄ3，可编辑语句：
DATA	D3; SET	D1 D2;

〖上机练习２.１〗进入SAS的显示管理系统,
在编辑窗口输入程式：




data d1;
input g$ a b @@; cards;
1 5 7 1 7 9 1 3 4
;
data d2;	input g$ a c@@; cards;
2 4 8 2 6 6 2 8 10
;
data d3；set d1 d2;
proc print; run;

将程式提交运行后，注意日志窗口中的信息,
如无ERROR，则转到输出窗口。
本程式运行的结果如下：

OBS	G	A	B	C
1	1	5	7	.
2	1	7	9	.
3	1	3	4	.
4	2	4	.	8
5	2	6	.	6
6	2	8	.	10

２.６ MERGE语句



MERGE语句的作用是将两个数据集中的各个观测值 横向合并建立新的数据集。
MERGE语句的格式为：
MERGE 数据集名表；
例如，将数据集D1与D2中的观测值横向合并建
立新的数据集D3，可编辑语句：


data D3 ；
merge D1 D2；
run;

〖上机练习２.２〗进入ＳＡＳ的显示管理系统，
在编辑窗口输入程式：
data d1；input a b c @@;
cards;
1 5 7 1 7 9 1 3 4 1 2 6
;

data d2;	input x y z@@; cards；
2 4 8 2 6 6
;
data d3；merge d1 d2；
proc print; run;







本程式运行的结果如下：

OBS	A	B	C	X	Y	Z
1	1	5	7	2	4	8
2	1	7	9	2	6	6
3	1	3	4	.	.	.
4	1	2	6	.	.	.

２.７ DROP语句
DROP语句的作用是指定不写到数据集中的变量。
DROP语句的格式为：
DROP 变量名表；
如果在DATA步中有DROP语句，那么DROP
语句中已出现的变量的观测值被删除,未出现的变量的
观测值仍保留在新的数据集中。

２.８ KEEP语句
KEEP语句的作用是指定要写到数据集中的变量。
KEEP语句的格式为：
KEEP变量名表；
如果在DATA步中有KEEP语句，那么KEEP语句中
未出现的变量的观测值被删除，已出现的变量的观测值

被2保011/留10/1在4

新的数据集中.	27


２.９ IF语句
IF语句的作用是使SAS继续处理符合IF条件
规定的观测值，因而所得到的数据集是原数据集的子集.
IF语句的格式为：
IF 条件表达式；



如果表达式的值是真，SAS处理当前的观测值， 执行DATA步中的语句. 如果表达式的值是假， SAS马上返回到DATA步的开始，不处理当前 的观测值，不执行DATA步中的语句.


〖上机练习２.３〗进入ＳＡＳ的显示管理系统， 在编辑窗口输入程式：
data ex; input group$ age @@;
cards;
x 23 y 10 x 7 y 22 x 8 y 4
x 21 y 12 x 9 y 22 x 6 y 2
;
data ex1; set ex;	if group=’x’; proc print;
data ex2;set ex；if age<20;
proc print; run;










本程式运行的结果如下：
OBS	GROUP	AGE

OBS	GROUP	AGE
1	y	10

1	x	23	2	x	7
2	x	7	3	x	8
3	x	8	4	y	4
4	x	21	5	y	12
5	x	9	6	x	9
6	x	6	7	x	6
			8	y	2

２.10	PROC语句
PROC语句的作用是指定需要调用的过程以及该
过程的若干选择项。 PROC语句的格式为： PROC	SAS的过程名；
例如，调用print过程，打印数据集ex的内容：



PROC	print data＝ex； 这里的data＝数据集名,用来指定本过程所要
处理的数据集名,如缺省则处理最新建立的数据集. 在PROC步中,还必须确认一些最基本的信息,包括：
(1)处理的数据集名，格式为data＝数据集名； (2)所涉及的变量名，格式为var		变量名； (3)分组处理的标志，格式为by	组变量名。


2.11	class语句 class语句的作用是在分析的过程中定义分类变量，
再按分类变量的值分组进行数据分析。
class语句的格式为：
class 变量名；
class语句对数据分析所起的作用类似于by语句，
但是它们打印输出的格式不相同，并且by语句要求先
对变量排序后才能使用。

2.12	freq语句
freq语句的作用是规定一个变量，以它的值作
为数据集中观测值出现的频数。
freq语句的格式为：
freq 变量；


假定某观测值的freq变量的值为ｎ，在分析时， 该数据集中这个观测值出现的频数便是ｎ。 若ｎ＜１，则观测值不参加分析。若ｎ不是整数， 则自动取整。观测值的总数等于freq变量的和。

〖上机练习２.４〗进入SAS的显示管理系统， 在编辑窗口输入程式：
data xzh;
input group$ sex$ age number@@; cards;
x f 23 10 y f 22 8
x m 21 12 y m 22 6
;
proc means maxdec=3;class group;var age; proc means maxdec=3;class group;
freq number;var age; run;

程式中的maxdec=3用来确定输出的数值只保留三位
小数.	本程式运行的结果如下：
Analysis Variable : AGE

````
## GROUP N Obs	N	Minimum	Maximum	Mean	Std Dev
x	2	2	21.000	23.000	22.000	1.414

## y	2	2	22.000	22.000	22.000	0.000
Analysis Variable : AGE

## GROUP N Obs	N	Minimum	Maximum	Mean	Std Dev
x	22	22	21.000	23.000	21.909	1.019

## y	14	14	22.000	22.000	22.000	0.000
````



第三讲 SAS服务过程
SAS服务过程不能直接给出统计值,专门用来准备或
整理统计资料.使频次最多的SAS语言服务过程有：

３.１ Print过程
print过程可以打印一个SAS数据集中的全体或部
分观测值,还可以打印数值变量的总和或部分和。
在print过程中经常使用的语句有：
proc	print［选择项］；
var	变量表；
by	变量表；
sum	变量表；

在proc	print语句中可能出现的选择项有
data＝数据集名，如果省略这一选择，则打印最
新建立的数据集中的数据。
sum语句被用来求变量表中诸变量的总和。



３.２ sort过程 sort过程将SAS数据集中的观测值按一个或多
个变量的值进行排序，以便其他的SAS过程利用by 语句对这些观测值进行分组处理，排序后的观测值存
放在一个新的SAS数据集中或者代替原来的数据集。


在sort	过程中经常使用的语句有：
proc sort ［选择项］；
by	变量表；
在proc sort语句中可能出现的选择项有
data＝数据集名，用来说明要排序的数据集名，
如果省略这一选择，则指定最新建立的数据集。
还有out＝数据集名，用来说明要输出的数据集名， 如果省略这一选择，则原来的数据集被输出的
数据集替换。

〖上机练习３.１〗进入ＳＡＳ的显示管理系统， 在编辑窗口输入程式：
data ex; length name$ 9;
input name sex$ group$ t1-t3 @@; s=sum(of t1-t3);	cards;
wangdong 1 1 90 70 60 xueping 2 2 85 95 88
zhouhua 1 1 77 84 69 heyan 1 2 95 78 88
sunhong 2 3 89 97 87 zhaobin 2 3 66 98 86
huangshan 2 3 67 75 76 hufang 1 2 78 77 69
lili 2 2 70 82 63 zhaoli 2 3 95 90 91
zhangqun 1 1 93 91 89 iping 1 3 59 88 93
liyun 1 1 89 96 76 liyu 2 1 79 89 87
huajin 2 2 89 97 80
;
2011p/10r/1o4 c sort;by group s;	proc print;by group;ru3n9 ;






这里是按Ｓ的值升序排列，若要按Ｓ的值降序排列， 则应在ＢＹ语句中Ｓ的前面增加选择项descending。 程式中的length name$ 9用来定义字符串的长度，
当全部字符串的长度为８时，可以省略这个语句。


























2011/10/14	40

本程式运行的结果如下：
--------------------- GROUP=1 ----------------------
OBS	NAME	SEX	T1	T2	T3	S
1	wangdong	1	90	70	60	220
2	zhouhua	1	77	84	69	230
3	liyu	2	79	89	87	255
4	liyun	1	89	96	76	261
5	zhangqun	1	93	91	89	273
--------------------- GROUP=2 ----------------------
OBS	NAME	SEX	T1	T2	T3	S
6	lili	2	70	82	63	215
7	hufang	1	78	77	69	224
8	heyan	1	95	78	88	261
9	huajin	2	89	97	80	266

2011/10/114

0	xueping	2	85	95	88	268 41


---------------------- GROUP=3 ----------------------
OBS	NAME	SEX	T1	T2	T3	S
11	huangshan	2	67	75	76	218
12	iping	1	59	88	93	240
13	zhaobin	2	66	98	86	250
14	sunhong	2	89	97	87	273
15	zhaoli	2	95	90	91	276


３.３ FORMAT过程
Format过程可以对字符或数值变量定义一个所
需要的输出格式，使data步以及含有FORMAT语句的过
程步中的变量都受到这一输出格式的限制。 通过proc FORMAT过程所定义的格式包括：
(1)将输出值转变成不同的值、数值可以变成字符、 字符可以变成另外的字符。
(2)使输出值保留一定的小数位，否则输出值将有８个
小数位。

FORMAT过程由下列语句控制：
proc FORMAT ；
value	格式名 格式的定义；
为便于识别，格式名通常是原变量名加fmt，
如果原变量是字符串，则应当在格式名前加串符号。 后面的过程中,如果涉及到某变量的输出格式, 必须有语句:
FORMAT 变量名 格式名．

〖上机练习３.２〗进入ＳＡＳ的显示管理系统， 在编辑窗口输入程式：
data ex;	length name$10;
input name sex$ group$ t1-t3 @@; cards;
wangdong 1 1 90 70 60 xueping 2 2 85 95 88
zhouhua 1 1 77 84 69 heyan 1 2 95 78 88
sunhong 2 3 89 97 87 zhaobin 2 3 66 98 86
huangshan 2 3 67 75 76 hufang 1 2 78 77 69
lili 2 2 70 82 63 zhaoli 2 3 95 90 91
zhangqun 1 1 93 91 89 iping 1 3 59 88 93
liyun 1 1 89 96 76 liyu 2 1 79 89 87
huajin 2 2 89 97 80
;

proc format;
value $sexfmt '1'='m' '2'='f';
value $groupfmt '1'='a' '2'='b' '3'='c';
value t1fmt 0-<60='C' 60-<80='B' 80-100='A';
proc print;
format sex $sexfmt. ; format group $groupfmt. ; format t1 t1fmt. ;
format t2 t3 4.1;run;
这里的sex、group是串变量，格式名为$sexfmt、
$groupfmt，t1为数值变量格式名为t1fmt，
t1的格式定义是0-<60变换为 C、60-<80变换为 B、
80-100变换为 A。

2011本/10/1程4

式运行的结果如下：	46

OBS	NAME	SEX GROUP T1	T2	T3

1	wangdong	m	a	A	70.0	60.0
2	xueping	f	b	A	95.0	88.0
3	zhouhua	m	a	B	84.0	69.0
4	heyan	m	b	A	78.0	88.0
5	sunhong	f	c	A	97.0	87.0
6	zhaobin	f	c	B	98.0	86.0
7	huangshan	f	c	B	75.0	76.0
8	hufang	m	b	B	77.0	69.0
9	lili	f	b	B	82.0	63.0
10	zhaoli	f	c	A	90.0	91.0
11	zhangqun	m	a	A	91.0	89.0
12	iping	m	c	C	88.0	93.0
13	liyun	m	a	A	96.0	76.0
14	liyu	f	a	B	89.0	87.0
2011/10/1415	huajin	f	b	A	97.0	80.0 	47


３.４ Standard过程 Standard过程按给定的平均值和标准差对sas
数据集中的部分或全体变量进行“标准化”变换， 并形成新的数据集。
在Standard过程中经常使用的语句有：
proc Standard ［选择项］；
var	变量表；
freq	变量表；
by	变量表；



在proc Standard语句中可能出现的选择项有
data＝数据集名,用来说明要“标准化”变换的数据集名,
如果省略这一选择，则指定最新建立的数据集。 还有out＝数据集名,用来说明含有“标准化”变量的新数 据集名，如果省略这一选择，sas将按内部程式给出新
的数据集名。 此过程将打印输出每个“标准化”变量的输入频数、
平均值及标准差。




〖上机练习３.３〗进入ＳＡＳ的显示管理系统， 在编辑窗口输入程式：

data st;	length name$10;
input name sex$ group$ t1-t3 @@; cards;
wangdong 1 1 90 70 60 xueping 2 2 85 95 88
zhouhua 1 1 77 84 69 heyan 1 2 95 78 88
sunhong 2 3 89 97 87 zhaobin 2 3 66 98 86
huangshan 2 3 67 75 76 hufang 1 2 78 77 69
lili 2 2 70 82 63 zhaoli 2 3 95 90 91
zhangqun 1 1 93 91 89 iping 1 3 59 88 93
liyun 1 1 89 96 76 liyu 2 1 79 89 87
huajin 2 2 89 97 80
;

data st; set ex; st1=t1; st2=t2; st3=t3; proc standard mean=80 std=5 out=new; var st1-st3;	format st1-st3 5.2;
proc print data=new;
proc means data=new(drop=name group) maxdec=1;	run;



程式中的format st1-st3 5.2用来定义新变量的格式、 即小数点前两位、小数点后两位、包括小数点共计五位， 可以省略这个语句。

本程式运行的结果如下：
NAME	MEAN	STD	N
ST1	81.40	11.58	15
ST2	87.13	9.04	15
ST3	80.13	10.68	15

OBS	NAME	SEX GROUP	T1	T2	T3	ST1	ST2	ST3
1	wangdong	1	1	90	70	60	83.71	70.52	70.57
2	xueping	2	2	85	95	88	81.55	84.35	83.68
3	zhouhua	1	1	77	84	69	78.10	78.27	74.79
4	heyan	1	2	95	78	88	85.87	74.95	83.68
5	sunhong	2	3	89	97	87	83.28	85.46	83.22
6	zhaobin	2	3	66	98	86	73.35	86.01	82.75
7	huangshan	2	3	67	75	76	73.78	73.29	78.06
8	hufang	1	2	78	77	69	78.53	74.39	74.79
9	lili	2	2	70	82	63	75.08	77.16	71.98
10	zhaoli	2	3	95	90	91	85.87	81.59	85.09
11	zhangqun	1	1	93	91	89	85.01	82.14	84.15
12	iping	1	3	59	88	93	70.33	80.48	86.03
13	liyun	1	1	89	96	76	83.28	84.90	78.06
14	liyu	2	1	79	89	87	78.96	81.03	83.22
15	huajin	2	2	89	97	80	83.28	85.46	79.94


2011/10/14

83.71=(90-81.4)*5/11.6+80	53




N Obs	Variable	N	Minimum	Maximum	Mean	Std Dev
15	T1	15	59.0	95.0	81.4	11.6
	T2	15	70.0	98.0	87.1	9.0
	T3	15	60.0	93.0	80.1	10.7
	ST1	15	70.3	85.9	80.0	5.0
	ST2	15	70.5	86.0	80.0	5.0
	ST3	15	70.6	86.0	80.0	5.0


３.５ transpose过程 transpose过程将一个数据集进行转置，
使行变为列而列变为行，也就是使原数据集中样品的 观测值变换成新数据集中变量的观测值，而原数据集 中变量的观测值则变换成新数据集中样品的观测值。



transpose过程的格式为：
proc transpose ［选择项］；
var	变量表；
by	变量表；
在proc transpose语句中可能出现的选择项有：

(1) data＝数据集名,用来说明要转置的数据集名， 如果省略这一选择，则指定最新建立的数据集。 (2) Out ＝数据集名,用来说明转置所建立的新数
据集名,如果省略这一选择,SAS将按内部程式给出新 的数据集名。
(3) prefix=字母(指定一个前缀,用来构成新变量名).
(4)name=字母（为含有输入数据集中被转置的
变量名的输出数据集中的变量命名,如果省略这一选择,
sas将按内部程式指定）。

在var语句中应列出要被转置的变量名,否则原数 据集中未在其他语句中列出的所有数值型变量都将被
转置,字符型变量必须在var语句中列出才能被转置,
未被转置的变量不进入新的数据集,除非它们已列入
Copy或by语句。
by语句使输入数据集分组转置,分组变量被包括
在输出数据集中.

〖上机练习３.４〗进入SAS的显示管理系统， 在编辑窗口输入程式：
data xzh01;
input a b c @@; cards;
50 147 183
49 85 136
77 195 244
;
proc transpose prefix=y; proc print;
run;




本程式运行的结果如下：



OBS	_NAME_	Y1	Y2	Y3
1	a	50	49	77
2	b	147	85	195
3	c	183	136	244





## 第十六课	用在PROC步中的通用语句




当我们用DATA步创建好SAS数据集后，可以用SAS的一些PROC过程步来进一步的分析和处理它们。在DATA步中用户可以使用SAS的语句来编写自己的程序，以便能通过读入、处理和描述数据，创建符合自己特殊要求的SAS数据集。而后由一组组PROC步组成的程序进行后续分析和处理。
一.	PROC程序的主要作用
	读出已创建好的SAS数据集
	用数据集中的数据计算统计量
	将统计的结果按一定形式输出
在SAS系统中，计算统计量时，对于许多常用的和标准的统计计算方法，并不需要用户自己编写这些复杂的程序，而是通过过程的名字来调用一个已经为用户编写好的程序。用户通常只要编写调用统计过程前的准备处理程序和输出统计结果后的分析和管理程序。只有用户自己非常特殊的统计计算方法才需要用户自己编写相应的计算程序。
二.	PROC过程语句
PROC语句用在PROC步的开始，并通过过程名来规定我们所要使用的SAS过程，对于更进一步的分析，用户还可以在PROC语句中使用一些任选项，或者附加其它语句及它们的任选项（如BY语句）来对PROC步规定用户所需要分析的更多细节。PROC语句的格式为：

  PROC   过程名   <选项>    ;

过程名规定用户想使用的SAS过程的名字。例如，我们在前面常使用的打印过程名PRINT，对数值变量计算简单描述统计量的过程名MEANS。
选项规定这个过程的一个或几个选项。不同的过程规定的选项是不同的，因此，只有知道具体的过程才能确定具体的选项是什么。但是，在各个不同过程中使用选项时，下面三种选项的使用格式是共同的：
	Keyword
	Keyword=数值
	Keyword=数据集
Keyword是关键字，第一种选项格式是某个具体过程进一步要求某个关键字；第二种选项格式是某个具体过程要求某个关键字的值，值可能是数值或字符串；第三种选项格式是某个具体过程要求输入或输出数据集。例如：

  PROC   Print   Data=class   ;

过程Print，作用为打印输出数据集中的数据。选项为Data=class，关键字是Data，进一步说明要打印输出的数据集名为class。如果省略这个选项，将用最近产生的SAS数据集。

  PROC   Plot    Hpct=50  Vpct=33  ;

过程Plot，作用为描绘变量的散布图。现有两个表示图形大小的选项为Hpct=50 、Vpct=33，关键字Hpct 和Vpct的值分别表示在水平和垂直方向上占一页中的比例。数值50表示占一页的50%，即全页的一半。

  PROC   Means   Data=class  Maxdec=3   CSS ;

过程Means，作用为对数值变量计算简单描述统计量。现有三个选项为Data=class 、 Maxdec=3 、CSS 。选项Maxdec=3表示该过程输出结果中，小数部分的最大位数为3。选项CSS，是单个关键字，指出MEANS过程选用的计算统计量的方法，在MEANS过程中共有几十种计算统计量方法，CSS表示计算均值偏差的加权平方和。
三.	用在PROC步的通用语句
能够出现在PROC步的SAS语句主要分成：
	过程信息语句、
	变量属性语句
	可用在任何地方的全局语句
下面我们列出语句是PROC过程中最常用的一些通用语句，还有很多其它语句对不同的过程是专用的。
1	VAR语句（变量语句）
VAR语句可用在不同的SAS过程中，被用来给出要分析的变量。该语句的格式为：

  VAR       变量列表   ;

变量列表给出过程将要分析的数据集中的一些变量。变量列表的任意有效形式都是可以使用的。通常VAR语句是放在过程的开始处。另外，VAR语句中的变量顺序，也是将来输出结果时的变量顺序。
2	MODEL语句（模型语句）
MODEL语句可用在不同的SAS统计过程中，被用来规定分析的模型。尽管MODEL语句的具体语句形式依赖于使用的具体过程，但MODEL语句的一般使用格式为：

  MODEL     因变量列表=自变量列表 </选项>  ;

MODEL语句在使用时，要说明哪些变量是因变量，哪些变量是自变量。另外，不要把“=”号看作是等号或赋值号的作用。例如：
Model  y=x1-x5 ;
自变量x1、x2、x3、x4、x5，因变量y。
Model  y1 y2= a b c d 
自变量a、b、c、d，因变量有两个y1和y2。
3	WEIGHT语句（权数语句）
WEIGHT语句可用在不同的SAS过程中，用来规定一个变量，它的值是这些观测相应的权数。该语句的格式为：

  WEIGHT       变量   ;

WEIGHT语句常常用在这样一些分析中，比如与每个观测有联系的方差不等时，那么可引入一个权数变量，其值和方差的倒数成比例。
4	FREQ语句（频数语句）
FREQ语句可用在不同的SAS过程中，用来规定一个变量，它的值表示这个观测出现的频数。该语句的格式为：

  FREQ      变量   ;

如果在某个观测中，FREQ变量的值小于1，这个观测在分析中不使用；如果FREQ变量的值不是整数，仅取整数部分使用。注意FREQ语句和WEIGHT语句的区别。FREQ变量表示观测出现的次数；WEIGHT变量给出观测相应的权数。当每个观测的权数都是整数时，WEIGHT语句也可用FREQ语句代替。
5	ID语句
ID语句可用在不同的SAS过程中，用来规定一个或几个变量，它们的值在打印输出或这个过程产生的SAS数据集中用来识别观测。该语句的格式为：

  ID      变量列表   ;

使用了ID语句后，最左边的OBS列被取消了，且ID语句所指定的变量被排列在输出结果报告的最左边。例如，当一个ID语句同PRINT过程一起使用时，输出的观测用ID变量的值来识别，而观测本来的序号没有被打印输出。
6	CLASS语句
CLASS语句可用在不同的SAS过程中，用来指定一些分类变量，SAS过程按分类变量的不同值分别进行分析处理。该语句的格式为：

  CLASS      变量列表   ;

例如，我们要按男女分类统计SURVEY数据集中收入INCOME的平均值。程序如下：

Libname     Study "d:\sasdata\mydir" ;
Proc Means  Data=Study.Survey ;
    Class  Sex ;
    Var    Income ;
Title “How to use CLASS statement”
Run ;

程序运行结果见图16－1所示。
7	BY语句
当用户要求SAS系统对数据集进行分组处理时，可在PROC步中使用BY语句。但处理过程要求数据集事先已经按BY变量排序好了。该语句的一般格式为：

BY  <descending>  变量1  <…变量2>  <NOTSORTED>  ;

DESCENDING选项表示它后面的一个变量按降序排列。要特别注意BY后面的变量排列的先后次序，表示分组的的先后次序。例如有一个关于通讯录的数据集，我们要按居住的城市（City）降序排列，同一城市中按邮编（Zipcode）的升序排列。BY语句的使用格式为：
BY  DESCENDING  City  Zipcode
NOTSORTED选项并不是说数据不要求排序，而是要求数据按组整理，并且这些组不必按字母顺序或数值的顺序排序。
但如果要处理的数据集事先没有按BY变量的升序排序，可使用如下几种方法先处理一下数据集：
	在SORT过程中用相同的BY语句对观测进行排序。
	用Base SAS软件中DATASETS过程对BY变量生成一个索引。
	在PROC调用过程的BY语句中使用NOTSORTED。
例如，我们有一个没有按任何变量排序过的SURVEY03数据集，现在要想按男女分组显示观测的NAME和INCOME变量的内容。程序如下：

```sas
Libname     Study "d:\sasdata\mydir" ;
Proc Sort    Data=Study.Survey03 ;
By  Sex ;
Proc Print  DATA=Study.Survey03 ;
Proc Print  DATA=Study.Survey03 ;
    By  Sex ;
    Var  Name  Income ;
    Id   Sex ;
Run ;
```

CLASS语句与BY语句是有所区别的。CLASS语句使用时，不要求数据集事先按CLASS指定的变量排序，按指定变量的不同值进行分类计算和分析后，输出的分类结果列在一张报表里。而BY语句在使用时，要求数据集事先按BY指定的变量排序，且输出的结果也按分组列出许多报表。





## 参考文献

SAS常用语句.doc