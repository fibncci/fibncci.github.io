# node聊天室

### 要求：

```

每个人有自己的昵称，在进入聊天室的时候自己输入。
每个人都可以发言

有一个区域用来展示所有的发言，并且要实时更新

有人加入的时候提示xxx加入了群聊
```





用户和服务器的通信就只能是：用户发送请求 -> 服务器接受请求 -> 服务器返回结果 -> 用户收到结果。

```
➜  node-chat1 git:(master) ✗ node -v
v10.16.0
➜  node-chat1 git:(master) ✗ npm -v 
6.9.0

因为npm是国外的库可能有点慢，可以安装cnpm，执行下面命令
mac继续在终端输入：sudo npm install -g cnpm --registry=https://registry.npm.taobao.org

➜  test-js git:(master) ✗ cnpm -v
cnpm@6.1.0 (/usr/local/lib/node_modules/cnpm/lib/parse_argv.js)

linux乌班图
npm install -g cnpm --registry=https://registry.npm.taobao.org

然后输入
cnpm install --save express
等待安装成功，再安装
cnpm install --save socket.io
都安装成功之后我们就可以开始着手Coding了。

➜  test-js git:(master) ✗ node /Users/tianzi/Desktop/test-js/node-chat1/server.js
listening on *:3000


```

### 聊天室模型：

```
listening on *:3000



a user connected
a user connected
a user connected

---------------------------聊天内容
1 加入了群聊
2 加入了群聊
111
wocao
sdjj
dsadasd
dasdjajdsa
d
dskandjaskdjjdsajljkld;lkldall;kadkl;kl;dslkl;ks
saasd .
dsadjksajodas
hfjklsakjlfjjiojjfjijiofjjfjkjkfwjkfwjjojkjkkjjkjojpojkfwjojwjoojwjopjowjjowjopjopejojopvjopjopejojopjopjopjopjopjjopjjwopjwjopfjjfjwnfnwnlkfpjwjfpjowjfwp
5 加入了群聊

```



### 

### 在server.js中写下以下代码：

```
用Nodejs搭建一个服务器。其中用到了express这个框架


【二】server.js 服务器接受消息

只需要两步：
监听前端的message事件
在监听到事件之后，将新消息广播给全体用户，这里也将广播事件的名字叫message吧。

 var app = require('express')(); //引入express库
var http = require('http').Server(app); //将express注册到http中

//当访问根目录时，返回Hello World
app.get('/', function(req, res){
  res.send('<h1>Hello world</h1>');
});

//启动监听，监听3000端口
http.listen(3000, function(){
  console.log('listening on *:3000');
});
```



### index.html



```html
【一】index.html 将用户消息发送给服务器

用户输入消息，然后点击发送我们将用户的消息发送给服务器，然后服务器将消息广播给所有的用户。
我们需要给form的提交绑定一个事件，让它来处理新消息的发送。
【三】index.html 客户接受新消息

客户接收到服务器发来的message事件，将新消息呈现在面板中。

<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
    </style>
  </head>
  <body>
    <ul id="messages"></ul>
    <form action="">
      <input id="m" autocomplete="off" /><button>发送</button>
    </form>
  </body>
</html>
```

### 测试：

```
1. 开启服务器node server.js。
node /Users/tianzi/Desktop/test-js/node-chat1/server.js
listening on *:3000


2. 开一个标签（网页），输入地址localhost:3000，回车，填写昵称为1 。
http://localhost:3000/
或者127.0.0.1:3000
3. 再开一个标签，网页，填写昵称为2。

然后开始让两个人互相发送消息吧。
至此，聊天室以就做完了。
```



### 总结：

用户a将自己的消息用*`message`*事件发送给服务器，服务器监听*`message`*事件接收其中的消息，将消息用事件*`message`*广播给全体用户，全体用户监听*`message`*事件，将事件接受到的消息呈现在聊天框中。PS:这一段是整个socket编程的核心，可以多读几遍细细理解。

























# node：实现一个简单的登陆注册



 

现在让我们用学过的知识，来做一个简单的登陆注册，前提是前面的几节内容都掌握了哦
思路：

### 用户注册：

1，输入用户名和密码，点击登陆
2，如果用户已注册提示用户已存在，第一次注册提示注册成功，其他不做验证

### 用户登陆：

1，输入用户名和密码，点击登陆
2，如果用户不存在做出相应提示，如果用户名或者密码输入错误做出相应提示，如果登陆成功，提示登陆成功

#### 一、前端部分

在nodenote文件夹下创建www文件夹，用于存放user.html，因为需要交互所以额外引入一个ajax文件，创建一个index.js,用户写js逻辑代码
1，user.html代码



2，index.js注册部分



3.index.js登陆部分





#### 二、后台部分

在nodenote文件夹下创建server.js
1,引入需要用到的模块，创建服务





2，接收数据完毕，在end中处理数据过程



这个时候你启动服务，输入localhost:8080,会报错，{ok：false,msg:'未知的act'}这是什么原因，原来是url有问题，我需要判断，可以打印处理url看一下，只有只想接口‘/user’的时候才能请求数据，而且页面用了ajax也需要用到服务环境，所以需要判断如果不是接口‘/user’，这个时候我应该在登陆页面，这里用到了fs的读取文件






