

## 2.5MySQL存储过程

MySQL存储过程 - MySQL 数据库管理系统

> Mysql储存过程是一组为了完成特定功能的SQL语句集，经过编译之后存储在数据库中，
>
> 当需要使用该组SQL语句时用户只需要通过指定储存过程的名字并给定参数就可以调用执行它了，
>
> 简而言之就是一组已经写好的命令，需要使用的时候拿出来用就可以了

```
\d //(修改语句结束符号)
create procedure p1()
begin
set @i=0;
while @i<10 do
insert into user values(null,concat('user',@i),@i,concat('user',@i,'@qq.com'),1,99);
set @i=@i+1;
end while;
end;
//
执行储存：call p1
查看存储具体信息：show create procedure p1\G
删除触发器: drop procedure p1;
```







## 2.4MySQL的触发器

```
格式：1、触发器的定义：
 CREATE TRIGGER trigger_name trigger_time trigger_event
   ON tbl_name FOR EACH ROW trigger_stmt

  说明：
  # trigger_name：触发器名称
  # trigger_time:触发时间，可取值：BEFORE或AFTER
  # trigger_event：触发事件，可取值：INSERT、UPDATE或DELETE。
  # tb1_name：指定在哪个表上
  # trigger_stmt：触发处理SQL语句。

-- 查看所有的 触发器
show triggers\G;

-- 删除触发器
drop trigger trigger_name;
```

-- 创建一个deluser的触发器,,当 对user表进行 删除 之前 往del_user中添加一个数据

```sql
\d //
create trigger deluser before delete on users for each row
begin
insert into del_user values(old.id,old.username,old.age,old.email,old.sex,old.account);
end;
//
```

-- 创建一个触发器,当对user表中数据进行添加时,修改统计的数据

```sql
\d //
create trigger countuser after insert on user for each row
begin
update user_count set num = num+1;
end;
//
```

**注意:**

**1,注意在触发器中的 执行语句,要保证SQL能够正确执行**

**2,在创建一个 insert 类型触发器时,在触发器中无法使用 old 来获取原来的数据,**

































































### MySQL的表复制

> 复制表结构
>
> mysql> create table 目标表名 like 原表名;
>
> 复制表数据
>
> mysql> insert into 目标表名 select * from 原表名;

### 数据表的索引操作

> PRIMARY, INDEX, UNIQUE 这3种是一类
>
> ```
> PRIMARY 主键。 就是 唯一 且 不能为空。
> 
> INDEX 索引，普通的
> 
> UNIQUE 唯一索引。 不允许有重复。
> ```
>
> FULLTEXT 是全文索引，用于在一篇文章中，检索文本信息的
>
> MySQL索引的建立对于MySQL的高效运行是很重要的，索引可以大大提高MySQL的检索速度
>
> 打个比方，如果合理的设计且使用索引的MySQL是一辆兰博基尼的话，那么没有设计和使用索引的MySQL就是一个人力三轮车
>
> 但过多的使用索引将会造成滥用。因此索引也会有它的缺点：虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件

```
 // 使用alter创建
 alter table user add index index_name(字段值)
 alter table user add unique unique_name(字段值)
 alter table user add primary key(字段值)
 // 使用 alter删除索引
 alter table user drop index index_name     // 删除普通索引和唯一索引
 alter table user drop primary key       // 删除主键(必须先删除自动递增)

 //  修改表结构：
 alter table user add aaa int after bbbb;
 alter table user modify username varchar(20);

//显示索引信息
//你可以使用 SHOW INDEX 命令来列出表中的相关的索引信息。可以通过添加 \G 来格式化输出信息。
mysql> SHOW INDEX FROM table_name; \G
```

## 2.3MySQL视图

```
创建视图:
mysql> create view v_t1 as select * from t1 where id>4 and id<11;
Query OK, 0 rows affected (0.00 sec)

view视图的帮助信息:
mysql> ? view
ALTER VIEW
CREATE VIEW
DROP VIEW

查看视图:
mysql> show tables;

删除视图v_t1:
mysql> drop view v_t1;
```

### MySQL常用内置函数

```
字符串处理函数

    *concat(s1,s2,…Sn) 连接s1,s2..Sn为一个字符串

    *length(str) 返回值为字符串str 的长度

数值函数

    *abs(x) 返回x的绝对值

    *round(x,y)返回参数x的四舍五入的有y位小数的值

日期和时间函数

    *now() 返回当前日期和时间,

    *unix_timestamp(date) 返回date时间的unix时间戳

    *date_fomat(date,fmt) 返回按字符串fmt格式化日期date值

    *datediff(expr,expr2) 返回起始时间和结束时间的间隔天数

    //统计时间戳647583423距离当前时间相差天数（生日天数（不考虑年份））

    mysql> select datediff(date_format(from_unixtime(647583423),"2017-%m-%d %h:%i:%s"),now());

其他常用函数

    *database() 返回当前数据库名

    version() 返回当前服务器版本

    user()    返回当前登陆用户名

    inet_aton 返回当前IP地址的数字表示 inet_aton("192.168.80.250");

    inet_ntoa(num) 返回当前数字表示的ip inet_ntoa(3232256250);

    *password(str) 返回当前str的加密版本

    *md5(str) 返回字符串str的md5值
```